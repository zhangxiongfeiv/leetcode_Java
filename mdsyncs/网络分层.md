网络分层

网络互连模型

- 为了更好的促进互联网的研究和发展，国际标准组织 ISO 在1985年制定了网络互连模型
  - OSI (Open System Interconnect Reference Model), 具有7层结构

![屏幕快照 2020-10-27 下午5.08.52](https://tva1.sinaimg.cn/large/0081Kckwly1gk407vvktnj31bm0j2tgj.jpg)





- 应用层
  - 协议 : FTP,HTTP,SMTP,DNS,DHCP
  - 报文，用户数据
- 传输层
  - 协议：TCP,UDP
  - 段(Segments)
- 网络层
  - IP，ARP，ICMP
  - 包(Packets)
- 数据链路层
  - CSMA,CD,PPP
  - 帧(Frames)
- 物理层
  - 比特流





物理层

- 物理层定义了接口标准，线缆标准，传输速率，传输方式等

![<u>屏幕快照 2020-10-27 下午5.20.58</u>](https://tva1.sinaimg.cn/large/0081Kckwly1gk40keriegj31au0kgtxy.jpg)



数字信号，模拟信号

模拟信号(Analog Signal)

- 连续的信号，适合长距离传输
- 抗干扰能力差，受到干扰时波形变形很难纠正

数字信号(Digital Signal)

- 离散的信号，不适合长距离传输
- 抗干扰能力强，受到干扰时波形失真可以修复





数据通信模型

- 局域网通信模型
  - PC	通过网线传输数字信号与集线器/交换机通信  
  - 另一台PC同样通过这种方式与集线器/交换机通信。 进而实现两台计算机通信
  - 注意网线不能超过100米
- 广域网通信模型
  - PC  通过网线与调制解调器(猫)通信 (传输数字信号)
  - 调制解调器通过电话线与另外一个调制解调器通信 (传输模拟信号)
  - 再由调制解调器将模拟信号转换问数字信号
  - 注意光纤的使用光电调制解调器



信道(Channel)

- 信道：信息传输的通道，一个传输介质上(比如网线) 上可以有多条信道
- 单工通信
  - 信号只能往一个方向传输，任何时候都不能改变信号的传输方向
  - 比如无线电广播，有线电视广播
- 半双工通信
  - 信号可以双向传输，但必须交替进行，同一时间只能往一个方向传输
  - 比如对讲机
- 全双工通信
  - 信号可以同时双向传输
  - 比如手机(听，说同时进行)



数据链路层

- 链路：从1个节点到相邻节点的一个段物理线路(有线或无线)，中间没有其他转换节点
- 数据链路: 在一条链路上传输数据时，需要有对应的通信协议来控制数据的传输
  - 不同类型的数据链路，所用的通信协议可能是不同的
    - 广播信道: CSMA/CD协议 (比如同轴电缆，集线器等组成的网络)
    - 点对点信道: PPP协议(比如2个路由器之间的信道)
- 数据链路的3个基本问题
  - 封装成帧
  - 透明传输
  - 差错检验



数据链路层 - 封装成帧

![屏幕快照 2020-10-27 下午5.37.21](https://tva1.sinaimg.cn/large/0081Kckwly1gk411dw125j30nu09umzf.jpg)



- 帧(Frame) 的数据部分
  - 就是网络层传递下来的数据包(IP数据包，Packet)
- 最大传输单元MTU (Maximum Transferr Unit)
  - 每一种数据链路层协议都规定了所能够传送的帧的数据长度上限
  - 以太网的MTU为1500个字节



数据链路层 - 透明传输

- 使用SOH(Start Of Header) 作为帧开始符
- 使用EOT(End Of Transmission) 作为帧结束符



会出现如下问题 :

当数据部分出现EOT时，部分数据会被当作无效帧而丢弃

![屏幕快照 2020-10-27 下午5.42.17](https://tva1.sinaimg.cn/large/0081Kckwly1gk416id4f5j30zk0a4770.jpg)



所以，数据部分一旦出现了SOH，EOT，就需要进行转义

![屏幕快照 2020-10-27 下午5.44.06](https://tva1.sinaimg.cn/large/0081Kckwly1gk418i95n4j310w0f840u.jpg)





数据链路层 - 差错校验

- FCS是根据数据部分 + 首部计算得出的![屏幕快照 2020-10-27 下午5.54.26](https://tva1.sinaimg.cn/large/0081Kckwly1gk41j5tx8pj30pu08qdhi.jpg)





CSMA/CD协议

- CSMA/CD (Carrier Sense Multiple Access with Collision Detection)
  - 载波侦听多路访问 / 冲突检测
- 使用了 CSMA/CD的的网络可以成为以太网(Ethenet), 它传输的是以太网帧
  - 以太网帧的格式有： Ethernet V2标准，以太网的帧至少64字节
  - 用交换机组建呢的网络，现在已经支持全双工通信，不再需要使用CSMA/CD，但它传输的帧依然是以太网帧
    - 所以，用交换机组建的网络，依然可以称为以太网





Ethernet V2帧的格式

![屏幕快照 2020-10-27 下午6.19.39](https://tva1.sinaimg.cn/large/0081Kckwly1gk429ed77dj31740iotpq.jpg)

- 首部 : 目标MAC + 源MAC
- 以太网帧 : 首部 + 数据 + FCS
- 数据的长度至少是: 64 -6 -6 -2 - 4 = 46字节
- 当数据部分的长度小于46字节时
  - 数据链路层会在数据的后面加入一些字节填充
  - 接收端会将添加的字节去掉
- 长度总结
  - 以太网帧的数据长度 : 46 - 1500字节
  - 以太网帧的长度 ： 64 - 1518字节(目标MAC + 源MAC + 网络类型 + 数据 + FCS)



网卡

![image-20201027182752857](https://tva1.sinaimg.cn/large/0081Kckwly1gk42hxfasgj30vi0fcjt1.jpg)



- 网卡接收到一个帧，首先会进行差错校验，如果校验通过则接收，否则丢弃
- Wireshark抓到的帧没有FCS，因为它抓到的是差错校验通过的帧(帧尾的FCS会被硬件去掉)
  - Wireshark抓不到差错校验的帧



PPP协议(Point to Point Protocol)

- Address字段 : 图中的值都是 0xFF, 形同虚设，点到点信道不需要源MAC，目标MAC地址
- Control字段 ：图中的值都是 0x03,目前没什么用
- Protocol字段 : 内部用到的协议类型
- 帧开始符，帧结束符: 0x7E

![image-20201027184551067](https://tva1.sinaimg.cn/large/0081Kckwly1gk430ojlwxj30za0d2dhl.jpg)





PPP协议 - 字节填充

![屏幕快照 2020-10-27 下午6.48.38](https://tva1.sinaimg.cn/large/0081Kckwly1gk4346w2wjj31360ci0wy.jpg)

